<div class="app-home app-h-100">
	<div fxLayout="column" fxFlexFill>
    <div class="app-topbar">
      <div class="app-breadcrumbs app-mb-4">
        <mat-icon class="material-icons-outlined app-mr-2">home</mat-icon>
        <a routerLink="/">home</a>
        <span class="app-separator">/</span>
        <span class="app-last">{{ 'breadcrumbs.' + view | translate }}</span>
      </div>
      <div>
        <nav mat-tab-nav-bar>
          <a mat-tab-link (click)="changeView('statistics')" [active]="view == 'statistics'"><mat-icon class="material-icons-outlined">bar_chart</mat-icon>{{ 'tabnav.statistics' | translate }}</a>
          <a mat-tab-link (click)="changeView('mostViewedDocuments')"  [active]="view == 'mostViewedDocuments'"><mat-icon class="material-icons-outlined">preview</mat-icon>{{ 'tabnav.mostViewedDocuments' | translate }}</a>
        </nav>
      </div>
    </div>
    <div fxFlex class="app-oa-y">
			<div class="app-container">
				<div>
					<mat-form-field class="app-mr-2">
						<mat-label>{{ 'desc.dateFrom' | translate }}</mat-label>
						<input matInput [matDatepicker]="from" [(ngModel)]="dateFrom" (dateChange)="changeEvent('change', $event)">
						<mat-datepicker-toggle matSuffix [for]="from" ></mat-datepicker-toggle>
						<mat-datepicker #from></mat-datepicker>
					</mat-form-field>
					<mat-form-field class="app-mr-2">
						<mat-label>{{ 'desc.dateTo' | translate }}</mat-label>
						<input matInput [matDatepicker]="to" [(ngModel)]="dateTo" (dateChange)="changeEvent('change', $event)">
						<mat-datepicker-toggle matSuffix [for]="to" ></mat-datepicker-toggle>
						<mat-datepicker #to></mat-datepicker>
					</mat-form-field>
					<!-- redady to implement for each filter same as is in processes-->
					<!-- <a mat-icon-button [matTooltip]="'desc.deselect' | translate" class="app-clear-filter app-mr-2">
            <mat-icon>cancel</mat-icon>
          </a> -->
					<mat-form-field class="app-mr-2">
						<mat-label>{{ 'desc.license' | translate }}</mat-label>
						<mat-select  [(ngModel)]="license" (selectionChange)="changeEvent('change', $event)">
							<mat-option *ngFor="let l of allLicenses" [value]="l"  >{{ l }}</mat-option>
						</mat-select>
					</mat-form-field>
					<!-- redady to implement for each filter same as is in processes-->
					<!-- <a mat-icon-button [matTooltip]="'desc.deselect' | translate" class="app-clear-filter app-mr-2">
            <mat-icon>cancel</mat-icon>
          </a> -->
					<!-- <mat-form-field>
						<mat-label>Pid / Čnb / Issn / Issbn</mat-label>
						<input matInput placeholder="Pid / Čnb / Issn / Issbn">
					</mat-form-field> -->
					<!-- redady to implement for each filter same as is in processes-->
					<!-- <a mat-icon-button [matTooltip]="'desc.deselect' class="app-clear-filter app-mr-2">
            <mat-icon>cancel</mat-icon>
          </a> -->
				</div>
				<ng-container  *ngIf="view == 'statistics'">
					<div fxLayout="row" fxLayoutGap="16px">
						<mat-card fxFlex class="app-card app-view-border">
							<mat-card-header>
								<mat-card-title>{{ 'desc.modelDisplayStatistics' | translate }}</mat-card-title>
							</mat-card-header>
							<mat-card-content *ngIf="isResultModel">
								<div echarts [options]="modelsOpts" style="height: 350px;" (chartClick)="onChartClick($event)"></div>
								<button mat-flat-button  (click)="csvModels()" color="primary" class="app-mr-2">CSV</button>
							</mat-card-content>
							<mat-card *ngIf="!isResultModel" class="app-view-alert app-info">
								<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
							</mat-card>
						</mat-card>
						<mat-card fxFlex class="app-card app-view-border">
							<mat-card-header>
								<mat-card-title>{{ 'desc.statisticsOfUsedLanguages' | translate }}</mat-card-title>
							</mat-card-header>
							<mat-card-content *ngIf="isResultLang">
								<div echarts [options]="langOpts" style="height: 350px;" ></div>
								<button mat-flat-button  (click)="csvLang()" color="primary" class="app-mr-2">CSV</button>
							</mat-card-content>
							<mat-card *ngIf="!isResultLang" class="app-view-alert app-info">
								<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
							</mat-card>
						</mat-card>
						<mat-card fxFlex class="app-card app-view-border">
							<mat-card-header>
								<mat-card-title>{{ 'desc.authorStatistics' | translate }}</mat-card-title>
							</mat-card-header>
							<mat-card-content *ngIf="isResultAuthor">
								<div echarts [options]="authorOpts" style="height: 350px;" ></div>
								<button mat-flat-button  (click)="csvAuthor()" color="primary" class="app-mr-2">CSV</button>
							</mat-card-content>
							<mat-card *ngIf="!isResultAuthor" class="app-view-alert app-info">
								<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
							</mat-card>
						</mat-card>
					</div>
				</ng-container>
				<ng-container  *ngIf="view == 'mostViewedDocuments'">
					<mat-card *ngIf="(table | keyvalue).length > 1" class="app-card app-view-border">
						<mat-card-content>
							<ng-container *ngFor="let item of table | keyvalue; let last = last">
								<div class="app-mb-4" [class.app-mb-n4]="last">
									<ng-container *ngIf="item.value.length > 0">
										<h3 class="app-mt-0 app-mb-2">{{ 'field.' + item.key | translate }}</h3>
										<table class="app-table" [cellPadding]="0" [cellSpacing]="0">
											<thead>
												<tr>
													<th class="app-first">{{ 'desc.numberOfImpressions' | translate }}</th>
													<th>{{ 'desc.work' | translate }}</th>
													<th class="app-last"></th>
												</tr>
											</thead>
											<tbody>
												<tr *ngFor="let v of item.value;">
													<td>{{v.count}}</td>
													<td [class.app-detail-expanded]="selection[v.pid]"> 
														<div [class.app-text-cutter-wrapper]="!selection[v.pid]">
															<div [class.app-text-cutter]="!selection[v.pid]">
																<a href="{{appSettings.coreBaseUrl}}/../view/{{v.pid}}" target="_blank" [matTooltip]="v.title">{{ v.title }}</a>
															</div>
														</div>
														<div *ngIf="selection[v.pid]" class="app-metadata">
															<div><label class="app-label">{{ 'desc.author' | translate }}</label> Pokorný, Václav Jan, Klášter Rajhrad</div>
															<div><label class="app-label">{{ 'desc.publishingData' | translate }}</label> 1913-1948</div>
															<div><label class="app-label">{{ 'desc.documentType' | translate }}</label> Úřední písemnosti, Archivní fondy</div>
															<div><label class="app-label">{{ 'desc.keywords' | translate }}</label> Pokorný, Václav Jan, Klášter Rajhrad</div>
															<div><label class="app-label">{{ 'desc.language' | translate }}</label> Latina, Čeština</div>
															<div><label class="app-label">{{ 'desc.storageLocation' | translate }}</label> <a href=""> Moravská zemská knihovna v Brně</a>, Signatura: BOE950R - A - D. n. 34</div>
															<div><label class="app-label">{{ 'desc.physicalDescription' | translate }}</label> Rozsah: 27 fol.</div>
															<div><label class="app-label">{{ 'desc.abstract' | translate }}</label> Žádosti o přijetí do noviciátu, doklady o kněžském svěcení (5. 7. 1918), domovský list, dekret o jmenování konservátorem ministerstva školství a osvěty pro státní památkovou péči ve správním okresu Moravský Krumlov (23. 5. 1947) aj.</div>
															<div><label class="app-label">{{ 'desc.comment' | translate }}</label> Latinský a český text, Psáno: Humanistickou kurzívou, též strojopis a tisk, Moravský zemský archiv v Brně.</div>
															<div><label class="app-label">{{ 'desc.page' | translate }}</label> 1</div>
														</div>
													</td>
													<td class="app-col-detail">
														<a (click)="showMore(v.pid)" fxLayout="row" fxLayoutAlign="start center" class="app-tdn" [ngClass]="selection[v.pid] ? 'app-rotate-up' : 'app-rotate-down'">
															<mat-icon>expand_more</mat-icon>
															{{ selection[v.pid] ? ('button.hideDetail' | translate) : ('button.showDetail' | translate) }}
														</a>
													</td>
												</tr>
											</tbody>
										</table>
									</ng-container>
								</div>
							</ng-container>
						</mat-card-content>
					</mat-card>
					<mat-card *ngIf="(table | keyvalue).length === 1" class="app-view-alert app-info">
						<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
					</mat-card>
				</ng-container>
			</div>
			</div>
  </div>
	
	
	
	
	
	
	<!-- <div class="app-mt-4 app-text-right">
		<mat-form-field class="app-mr-2">
			<mat-label>Datum od</mat-label>
			<input matInput [matDatepicker]="from" [(ngModel)]="dateFrom" (dateChange)="changeEvent('change', $event)">
			<mat-datepicker-toggle matSuffix [for]="from" ></mat-datepicker-toggle>
			<mat-datepicker #from></mat-datepicker>
		</mat-form-field>
		<mat-form-field class="app-mr-2">
			<mat-label>Datum do</mat-label>
			<input matInput [matDatepicker]="to" [(ngModel)]="dateTo" (dateChange)="changeEvent('change', $event)">
			<mat-datepicker-toggle matSuffix [for]="to" ></mat-datepicker-toggle>
			<mat-datepicker #to></mat-datepicker>
		</mat-form-field>
		<mat-form-field>
			<mat-label>Licence</mat-label>
			<mat-select  [(ngModel)]="license" (selectionChange)="changeEvent('change', $event)">
				<mat-option *ngFor="let l of allLicenses" [value]="l"  >{{ l }}</mat-option>
			</mat-select>
		</mat-form-field>
	</div>
	<mat-tab-group>
		<mat-tab label="Statistiky">
			<div fxLayout="row" fxLayoutGap="16px" class="app-mt-4">
				<mat-card fxFlex class="app-card app-view-border" *ngIf="isResult">
					<mat-card-header>
						<mat-card-title>Statistiky zobrazení modelů</mat-card-title>
					</mat-card-header>
					<mat-card-content>
						<div echarts [options]="modelsOpts" style="height: 350px;" (chartClick)="onChartClick($event)" ></div>
						<button mat-flat-button  (click)="csvModels()" color="primary" class="app-mr-2">CSV</button>
					</mat-card-content>
				</mat-card>
				<mat-card fxFlex class="app-card app-view-border" *ngIf="isResult">
					<mat-card-header>
						<mat-card-title>Statistiky použitých jazyků</mat-card-title>
					</mat-card-header>
					<mat-card-content>
						<div echarts [options]="langOpts" style="height: 350px;" ></div>
						<button mat-flat-button  (click)="csvLang()" color="primary" class="app-mr-2">CSV</button>
					</mat-card-content>
				</mat-card>
				<mat-card fxFlex class="app-card app-view-border" *ngIf="isResult">
					<mat-card-header>
						<mat-card-title>Statistiky autorů</mat-card-title>
					</mat-card-header>
					<mat-card-content>
						<div echarts [options]="authorOpts" style="height: 350px;" ></div>
						<button mat-flat-button  (click)="csvAuthor()" color="primary" class="app-mr-2">CSV</button>
					</mat-card-content>
				</mat-card>
			</div>
		</mat-tab>
		<mat-tab label="Nejvíce zobrazované dokumenty">
			<mat-card class="app-card app-view-border app-mb-4 app-mt-4">
				<mat-card-content>
					<div *ngFor="let item of table | keyvalue" class="app-mb-4">
						<div *ngIf="item.value.length > 0">
							<h3 class="app-mb-2">{{item.key}}</h3>
							<table class="app-table" [cellPadding]="0" [cellSpacing]="0">
								<thead>
									<tr>
										<th class="app-first">Počet zobrazení</th>
										<th>Dílo</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let v of item.value">
										<td>{{v.count}}</td>
										<td> 
											<a href="{{appSettings.coreBaseUrl}}/../view/{{v.pid}}" target="_blank">{{v.title}}</a> 
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</mat-card-content>
			</mat-card>
		</mat-tab>
	</mat-tab-group> -->
</div>