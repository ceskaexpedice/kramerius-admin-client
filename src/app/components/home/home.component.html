<div class="app-home app-h-100">
	<div fxLayout="column" fxFlexFill>
    <div class="app-topbar">
      <div class="app-breadcrumbs app-mb-4">
        <mat-icon class="material-icons-outlined app-mr-2">home</mat-icon>
        <span class="app-last">home</span>
      </div>
      <div>
        <nav mat-tab-nav-bar>
          <a mat-tab-link (click)="changeView('statistics')" [active]="view == 'statistics'"><mat-icon class="material-icons-outlined">bar_chart</mat-icon>{{ 'tabnav.statistics' | translate }}</a>
          <a mat-tab-link (click)="changeView('mostViewedDocuments')"  [active]="view == 'mostViewedDocuments'"><mat-icon class="material-icons-outlined">preview</mat-icon>{{ 'tabnav.mostViewedDocuments' | translate }}</a>
        </nav>
      </div>
    </div>
    <div fxFlex class="app-oa-y">
			<div class="app-container">
				<div>
					<mat-form-field class="app-mr-2">
						<mat-label>{{ 'desc.dateFrom' | translate }}</mat-label>
						<input matInput [matDatepicker]="from" [(ngModel)]="dateFrom" (dateChange)="changeEvent('change', $event)">
						<mat-datepicker-toggle matSuffix [for]="from" ></mat-datepicker-toggle>
						<mat-datepicker #from></mat-datepicker>
					</mat-form-field>
					<mat-form-field class="app-mr-2">
						<mat-label>{{ 'desc.dateTo' | translate }}</mat-label>
						<input matInput [matDatepicker]="to" [(ngModel)]="dateTo" (dateChange)="changeEvent('change', $event)">
						<mat-datepicker-toggle matSuffix [for]="to" ></mat-datepicker-toggle>
						<mat-datepicker #to></mat-datepicker>
					</mat-form-field>
					<!-- redady to implement for each filter same as is in processes-->
					<!-- <a mat-icon-button [matTooltip]="'button.deselect' | translate" class="app-clear-filter app-mr-2">
            <mat-icon>cancel</mat-icon>
          </a> -->
					<mat-form-field class="app-mr-2">
						<mat-label>{{ 'desc.license' | translate }}</mat-label>
						<mat-select  [(ngModel)]="license" (selectionChange)="changeEvent('change', $event)">
							<mat-option *ngFor="let l of allLicenses" [value]="l"  >{{ l }}</mat-option>
						</mat-select>
					</mat-form-field>
					<!-- redady to implement for each filter same as is in processes-->
					<!-- <a mat-icon-button [matTooltip]="'button.deselect' | translate" class="app-clear-filter app-mr-2">
            <mat-icon>cancel</mat-icon>
          </a> -->
					<mat-form-field>
						<mat-label>Pid / Čnb / Issn / Issbn</mat-label>
						<input matInput placeholder="Pid / Čnb / Issn / Issbn" [(ngModel)]="identifier"  (keyup)="onIdentKeyUp($event.target)">
					</mat-form-field>
					<!-- redady to implement for each filter same as is in processes-->
					<!-- <a mat-icon-button [matTooltip]="'button.deselect' class="app-clear-filter app-mr-2">
            <mat-icon>cancel</mat-icon>
          </a> -->
				</div>
				<ng-container  *ngIf="view == 'statistics'">
					<div fxLayout="row" fxLayoutGap="16px">
						<mat-card fxFlex class="app-card app-view-border">
							<mat-card-header>
								<mat-card-title>{{ 'desc.modelDisplayStatistics' | translate }}</mat-card-title>
							</mat-card-header>
							<mat-card-content *ngIf="isResultModel">
								<div echarts [options]="modelsOpts" style="height: 350px;" ></div>
								<button mat-flat-button  (click)="csvModels()" color="primary" class="app-mr-2">CSV</button>
							</mat-card-content>
							<mat-card *ngIf="!isResultModel" class="app-view-alert app-info">
								<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
							</mat-card>
						</mat-card>
						<mat-card fxFlex class="app-card app-view-border">
							<mat-card-header>
								<mat-card-title>{{ 'desc.statisticsOfUsedLanguages' | translate }}</mat-card-title>
							</mat-card-header>
							<mat-card-content *ngIf="isResultLang">
								<div echarts [options]="langOpts" style="height: 350px;" ></div>
								<button mat-flat-button  (click)="csvLang()" color="primary"  class="app-mr-2">CSV</button>
							</mat-card-content>
							<mat-card *ngIf="!isResultLang" class="app-view-alert app-info">
								<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
							</mat-card>
						</mat-card>
						<mat-card fxFlex class="app-card app-view-border">
							<mat-card-header>
								<mat-card-title>{{ 'desc.authorStatistics' | translate }}</mat-card-title>
							</mat-card-header>
							<mat-card-content *ngIf="isResultAuthor">
								<div echarts [options]="authorOpts" style="height: 350px;" ></div>
								<button mat-flat-button  (click)="csvAuthor()" color="primary"  class="app-mr-2">CSV</button>
							</mat-card-content>
							<mat-card *ngIf="!isResultAuthor" class="app-view-alert app-info">
								<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
							</mat-card>
						</mat-card>
					</div>
				</ng-container>
				<ng-container  *ngIf="view == 'mostViewedDocuments'">
					<mat-card  *ngIf="isResultModel" class="app-card app-view-border">
						<mat-card-content>
							<ng-container *ngFor="let item of table | keyvalue; let last = last">
								<div class="app-mb-4" [class.app-mb-n4]="last">
									<ng-container *ngIf="item.value.length > 0">
										<h3 class="app-mt-0 app-mb-2">{{ 'field.' + item.key | translate }}</h3>
										<table class="app-table" [cellPadding]="0" [cellSpacing]="0">
											<thead>
												<tr>
													<th class="app-first">{{ 'desc.numberOfImpressions' | translate }}</th>
													<th>{{ 'desc.work' | translate }}</th>
													<th class="app-last"></th>
												</tr>
											</thead>
											<tbody>
												<tr *ngFor="let v of item.value;">
													<td>{{v.count}}</td>
													<td [class.app-detail-expanded]="selection[v.pid]"> 
														<div [class.app-text-cutter-wrapper]="!selection[v.pid]">
															<div [class.app-text-cutter]="!selection[v.pid]">
																<a href="{{appSettings.coreBaseUrl}}/../view/{{v.pid}}" target="_blank" [matTooltip]="v.title">{{ v.title }}</a>
															</div>
														</div>
														<div *ngIf="selection[v.pid]" class="app-metadata">
															
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['author']"><label class="app-label">{{ 'desc.author' | translate }} : </label>{{descriptions[v.pid]['author']}}</div>
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['origininfo']"><label class="app-label">{{ 'desc.publishingData' | translate }} :</label> {{descriptions[v.pid]['origininfo']}}</div>
															<!--
															<div><label class="app-label">{{ 'desc.documentType' | translate }}</label> Úřední písemnosti, Archivní fondy</div>
															-->
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['keywords']"><label class="app-label">{{ 'desc.keywords' | translate }}</label> 
																<span *ngFor="let k of descriptions[v.pid]['keywords']; ; let isLast=last">
																	{{k}}{{isLast ? '' : ', '}}
																</span>
															</div>
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['langs']"><label class="app-label">{{ 'desc.language' | translate }}:</label> 
																<ng-container *ngFor="let l of descriptions[v.pid]['langs']; ; let isLast=last">
																	<span *ngIf="l && l!==''">
																		{{ 'lang.'+ l | translate }}{{isLast ? '' : ', '}}
																	</span>
																</ng-container>
															</div>
															
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['location'] && descriptions[v.pid]['location'].length>0"><label class="app-label">{{ 'desc.storageLocation' | translate }}</label> 
																<ng-container *ngFor="let l of descriptions[v.pid]['location']; ; let isLast=last">
																	<span *ngIf="l && l!==''">
																		{{  'sigla.'+ l | translate }}{{isLast ? '' : ', '}}
																	</span>
																</ng-container>
															</div>

															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['physicalDescription']"><label class="app-label">{{ 'desc.physicalDescription' | translate }}</label> 
																{{descriptions[v.pid]['physicalDescription']}}
															</div>

															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['abstract']"><label class="app-label">{{ 'desc.abstract' | translate }}</label> {{descriptions[v.pid]['abstract']}}</div>
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['note']"><label class="app-label">{{ 'desc.comment' | translate }}</label> {{descriptions[v.pid]['note']}}</div>

															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['isbn']"><label class="app-label">{{ 'desc.isbn' | translate }}</label> {{descriptions[v.pid]['isbn']}}</div>
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['issn']"><label class="app-label">{{ 'desc.isbn' | translate }}</label> {{descriptions[v.pid]['issn']}}</div>
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['barcode']"><label class="app-label">{{ 'desc.barcode' | translate }}</label> {{descriptions[v.pid]['barcode']}}</div>
															<!--
															<div *ngIf="descriptions[v.pid] && descriptions[v.pid]['uuid']"><label class="app-label">{{ 'desc.uuid' | translate }}</label> {{descriptions[v.pid]['uuid']}}</div>
															-->
														</div>
													</td>
													<td class="app-col-detail">
														<a (click)="showMore(v.pid)" fxLayout="row" fxLayoutAlign="start center" class="app-tdn" [ngClass]="selection[v.pid] ? 'app-rotate-up' : 'app-rotate-down'">
															<mat-icon>expand_more</mat-icon>
															{{ selection[v.pid] ? ('button.hideDetail' | translate) : ('button.showDetail' | translate) }}
														</a>
													</td>
												</tr>
											</tbody>
										</table>
									</ng-container>
								</div>
							</ng-container>
						</mat-card-content>
					</mat-card>

					<mat-card *ngIf="!isResultModel" class="app-view-alert app-info">
						<mat-card-content><mat-icon class="material-icons-outlined">info</mat-icon>{{ 'alert.statistics.noData' | translate }}.</mat-card-content>
					</mat-card>

				</ng-container>
			</div>
		</div>
  </div>
</div>