<div class="app-object app-h-100">
  <div fxLayout="row" fxFlexFill fxLayoutAlign="center center" *ngIf="!correctPid() && !checkingPid">
    <mat-card class="app-card app-view-border app-p-8" fxFlex="600px">
      <mat-card-content>
        <mat-form-field appearance="fill" class="app-mb-n4 app-w-100">
          <mat-label>{{ 'desc.enterTheUuidOfTheObject' | translate }}</mat-label>
          <input matInput [(ngModel)]="inputPid" placeholder="{{pid}}" (keyup.enter)="assignUuid()" type="text">
          <!-- <mat-error *ngIf="">
            Toto UUID je navalidní!
          </mat-error> -->
        </mat-form-field>
        <mat-error *ngIf="!!errorMessage">
          {{errorMessage}}
        </mat-error>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-progress-bar mode="indeterminate" *ngIf="checkingPid"></mat-progress-bar>

  <div fxLayout="column" fxFlexFill *ngIf="correctPid()">
    <div class="app-topbar">
      <div class="app-breadcrumbs app-mb-4">
        <mat-icon class="material-icons-outlined app-mr-2">home</mat-icon>
        <a routerLink="/">home</a>
        <span class="app-separator">/</span>
        <a routerLink="/object">{{ 'navbar.object' | translate }}</a>
        <span class="app-separator">/</span>
        <span class="app-last">{{ getCurrentRoute('string') }}</span>
      </div>
      <div>
        <nav mat-tab-nav-bar>
          <a mat-tab-link (click)="changeView('other')" [active]="view == 'other'">
            <!-- TODO: rename, translate -->
            <mat-icon class="material-icons-outlined">settings</mat-icon>ostatní
          </a>
          <a mat-tab-link (click)="changeView('collections')" [active]="view == 'collections'">
            <!-- TODO: rename, translate -->
            <mat-icon class="material-icons-outlined">collections</mat-icon>ve sbírkách
          </a>
          <a mat-tab-link (click)="changeView('rights')" [active]="view == 'rights'">
            <mat-icon class="material-icons-outlined">admin_panel_settings</mat-icon>{{ 'tabnav.rights' | translate }}
          </a>
          <a mat-tab-link (click)="changeView('accessibility')" [active]="view == 'accessibility'">
            <mat-icon class="material-icons-outlined">accessibility</mat-icon>{{ 'tabnav.accessibility' | translate }}
          </a>
        </nav>
      </div>
    </div>
    <div fxFlex class="app-oh app-oa-y">
      <div class="app-container">

        <!-- tab RIGHTS -->
        <mat-card fxLayout="column" class="app-card app-view-border app-p-0">
          <app-rights *ngIf="view == 'rights'" [pid]="pid"></app-rights>
        </mat-card>

        <!-- tab ACCESSIBILITY -->
        <mat-card fxLayout="column" class="app-card app-view-border app-p-0">
          <mat-progress-bar mode="indeterminate" *ngIf="loadingLicenses"></mat-progress-bar>
          <div *ngIf="view == 'accessibility' && !loadingLicenses">
            <!-- TODO: nastylovat -->
            <div>policy: {{policy}}
              <button (click)="onChangePolicy()" disabled>Změnit</button>
            </div>
            <h3>Licence</h3>
            <div *ngFor="let license of licenses">
              {{license}}
              <button (click)="onRemoveLicense(license)" disabled>Odebrat</button>
            </div>
            <br>
            <button (click)="onAddLicense()" disabled>Přidat licenci</button>
          </div>
        </mat-card>

        <!-- tab OTHER -->
        <mat-card fxLayout="column" class="app-card app-view-border app-p-0">
          <div *ngIf="view == 'other'">
            <div>
              <button mat-raised-button (click)="deleteObjectFromRepo()" color="primary">Smazat z repozitáře (jen
                objekt)</button>
            </div>
            <br>
            <div>
              <button mat-raised-button disabled (click)="deleteObjectTreeWithProcess()" color="primary">Naplánovat
                mazání stromu</button>
            </div>
            <br>
            <div>
              <button mat-raised-button (click)="indexObjectWithProcess()" color="primary">Naplánovat indexaci</button>
            </div>

            <!-- TODO: tlacitko prebudovat processing index pro objekt -->

            <!-- <ul>
              <li>TODO: export PDF?</li>
              <li>TODO: export FOXML?</li>
            </ul> -->
          </div>
        </mat-card>

        <!-- tab COLLECTIONS -->
        <!-- TODO: nastylovat, pro testovani odkomentovat .pipe(delay(3000)); v AdminApiService.getCollectionsContainingItem() -->
        <mat-progress-bar mode="indeterminate" *ngIf="loadingCollections"></mat-progress-bar>
        <mat-card fxLayout="column" *ngIf="view === 'collections' && !loadingCollections"
          class="app-card app-view-border app-maxh-100 app-p-0 app-oa-y">
          <a mat-flat-button color="primary" (click)="onAddThisToSuperCollection()" disabled>
            <!-- TODO: i18n -->
            <mat-icon>add_circle</mat-icon>Přidat do sbírky
          </a>
          <mat-card class="app-view-rights app-view-hover app-cursor-pointer"
            *ngFor="let superCollection of superCollections">
            <mat-card-header fxLayout="row" fxLayoutGap="16px">
              <div>
                <img [src]="getThumb(superCollection['id'])" />
              </div>
              <div fxFlex class="app-left">
                <mat-card-title>
                  <mat-icon>link</mat-icon>{{ getCollectionName(superCollection) }}
                </mat-card-title>
                <mat-card-subtitle>{{ getCollectionDescription(superCollection) }}</mat-card-subtitle>
              </div>
              <div class="app-right app-actions">
                <a (click)="onRemoveItemFromCollection(superCollection['id'], getCollectionName(superCollection), pid, title); $event.preventDefault(); $event.stopPropagation()"
                  [matTooltip]="'button.removeFromCollection' | translate" class="app-btn-warn">
                  <mat-icon>cancel</mat-icon>
                </a>
              </div>
            </mat-card-header>
          </mat-card>
          <!-- TODO: sbírky, co ho obsahují nepřímo (z indexu)? -->
        </mat-card>

      </div>
    </div>
  </div>
</div>