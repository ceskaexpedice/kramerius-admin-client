<div class="app-object app-h-100">
  <div fxLayout="row" fxFlexFill fxLayoutAlign="center center" *ngIf="!correctPid() && !checkingPid">
    <mat-card class="app-card app-view-border app-p-8" fxFlex="600px">
      <mat-card-content>
        <mat-form-field appearance="fill" class="app-mb-n4 app-w-100">
          <mat-label>{{ 'desc.enterTheUuidOfTheObject' | translate }}</mat-label>
          <input matInput [(ngModel)]="inputPid" placeholder="{{pid}}" (keyup.enter)="assignUuid()" type="text">
        </mat-form-field>
        <mat-error *ngIf="!!errorMessage">
          {{ errorMessage }}
        </mat-error>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-progress-bar mode="indeterminate" *ngIf="checkingPid"></mat-progress-bar>

  <div fxLayout="column" fxFlexFill *ngIf="correctPid()">
    <div class="app-topbar">
      <div class="app-breadcrumbs app-mb-4">
        <mat-icon class="material-icons-outlined app-mr-2">home</mat-icon>
        <a routerLink="/">home</a>
        <span class="app-separator">/</span>
        <a routerLink="/object">{{ 'navbar.object' | translate }}</a>
        <span class="app-separator">/</span>
        <span class="app-last app-text-cutter">
          <span [matTooltip]="title">{{ title }}</span>
        </span>
      </div>
      <div>
        <nav mat-tab-nav-bar>
          <a mat-tab-link (click)="changeView('rights')" [active]="view == 'rights'">
            <mat-icon class="material-icons-outlined">admin_panel_settings</mat-icon>{{ 'tabnav.rights' | translate }}
          </a>
          <a mat-tab-link (click)="changeView('accessibility')" [active]="view == 'accessibility'">
            <mat-icon class="material-icons-outlined">accessibility</mat-icon>{{ 'tabnav.accessibility' | translate }}
          </a>
          <a mat-tab-link (click)="changeView('collections')" [active]="view == 'collections'">
            <mat-icon class="material-icons-outlined">collections</mat-icon>{{ 'tabnav.inCollections' | translate }}
          </a>
          <a mat-tab-link (click)="changeView('other')" [active]="view == 'other'">
            <mat-icon class="material-icons-outlined">settings</mat-icon>{{ 'tabnav.others' | translate }}
          </a>
        </nav>
      </div>
    </div>

    <div fxFlex class="app-oh app-oa-y">
      <div class="app-container">
        <mat-card  *ngIf="view == 'rights'" fxLayout="column" class="app-card app-view-border app-p-0">
          <app-rights [pid]="pid"></app-rights>
        </mat-card>

        <ng-container *ngIf="view == 'accessibility'">
          <mat-progress-bar mode="indeterminate" *ngIf="loadingLicenses"></mat-progress-bar>
          <mat-card fxLayout="column" class="app-card app-view-border" *ngIf="!loadingLicenses">
            <mat-card-content>
              <div class="app-mb-4">
                <h3 class="app-mt-0">{{ 'desc.availability' | translate }}</h3>
                <div  fxLayout="row" fxLayoutAlign="start center">
                  <mat-icon class="app-mr-2">{{ policy === 'public' ? 'lock_open' : 'lock' }}</mat-icon><strong>{{ 'field.' + policy | translate }}</strong>
                  <button mat-flat-button color="primary" (click)="onChangePolicy()" class="app-ml-4">{{ 'button.changeAvailability' | translate }}</button>
                </div>
              </div>
              <mat-divider [inset]="true"></mat-divider>
              <div class="app-mt-4 app-mb-4">
                <h3 class="app-mt-0">{{ 'desc.license' | translate }}</h3>
                <table class="app-table" *ngIf="licenses?.length > 0">
                  <tbody>
                    <tr *ngFor="let license of licenses" class="app-mb-1">
                      <th>{{ license }}</th>
                      <td class="app-col-action">
                        <a class="app-btn-warn" (click)="onRemoveLicense(license)" [matTooltip]="'button.removeLicense' | translate">
                          <mat-icon>cancel</mat-icon>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <button mat-flat-button color="primary" (click)="onAddLicense()">{{ 'button.addLicense' | translate }}</button>
            </mat-card-content>  
          </mat-card>
        </ng-container>
       
        <ng-container *ngIf="view === 'collections'">
          <mat-card class="app-card app-view-border app-view-header" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="32px">
            <div fxFlex>
              <strong>{{ getCurrentRoute('string') }}</strong>
            </div>
            <div>
              <a mat-flat-button color="primary" (click)="onAddThisToSuperCollection()">
                <mat-icon>add_circle</mat-icon>{{ 'button.addToThisCollection' | translate }}
              </a>
            </div>
          </mat-card>
          <mat-progress-bar mode="indeterminate" *ngIf="loadingCollections"></mat-progress-bar>
          <mat-card fxLayout="column" *ngIf="!loadingCollections" class="app-card app-view-border app-p-0">
            <mat-card class="app-view-rights app-cursor-pointer" *ngFor="let superCollection of superCollections" [routerLink]="'/collections/' + getCurrentRoute('string')">
              <mat-card-header fxLayout="row" fxLayoutGap="16px">
                <div>
                  <img [src]="getThumb(superCollection['id'])" />
                </div>
                <div fxFlex class="app-left">
                  <mat-card-title><mat-icon>link</mat-icon>{{ getCollectionName(superCollection) }}</mat-card-title>
                  <mat-card-subtitle>{{ getCollectionDescription(superCollection) }}</mat-card-subtitle>
                </div>
                <div class="app-right app-actions">
                  <a (click)="onRemoveItemFromCollection(superCollection['id'], getCollectionName(superCollection), pid, title); $event.preventDefault(); $event.stopPropagation()" [matTooltip]="'button.removeFromCollection' | translate" class="app-btn-warn">
                    <mat-icon>cancel</mat-icon>
                  </a>
                </div>
              </mat-card-header>
            </mat-card>
            <!-- TODO: sbírky, co ho obsahují nepřímo od rodiče (z indexu)? Jen pro informaci, nebo proklik na sbírku-->
          </mat-card>
        </ng-container>
        

        <!-- tab OTHER -->
        <mat-card fxLayout="column" class="app-card app-view-border app-p-0" *ngIf="view == 'other'">
          <h4>Synchronizace</h4>
          <div>
            <button mat-raised-button (click)="indexObjectWithProcess()" color="primary">Reindexovat (vyhledávací
              index)</button>
          </div>
          <br>
          <div>
            <button mat-flat-button (click)="rebuildProcessingIndexForObject()" color="primary">{{
              'button.rebuildTheProcessingIndexForTheObject' | translate }}</button>
          </div>
          <br>
          <h4>Mazání</h4>
          <div>
            <button mat-raised-button disabled (click)="deleteObjectTreeWithProcess()" color="primary">Smazat celý
              strom
              (chytře)</button>
          </div>
          <br>
          <div>
            <button mat-raised-button (click)="deleteObjectFromRepo()" color="warn">Smazat z repozitáře (jen
              objekt)</button>
          </div>

          <h4>Exporty</h4>
          <div>
            <button mat-raised-button disabled color="primary">Export PDF</button>
          </div>
          <div>
            <br>
            <button mat-raised-button disabled color="primary">Export FOXML</button>
          </div>

          <!-- <ul>
            <li>TODO: export PDF?</li>
            <li>TODO: export FOXML?</li>
          </ul> -->
        </mat-card>
      </div>
    </div>
  </div>
</div>