<div class="app-processes">

  <div class="app-actions">

    <button class="app-action-btn" mat-raised-button (click)="scheduleProcess()" color="primary">Schedule Mock Process</button>

    <mat-form-field class="app-filter-state">
      <mat-select placeholder="Stav" [(value)]="filters.state" (selectionChange)="onSelectedStateChanged($event)">
        <mat-option value="">Vše</mat-option>
        <mat-option *ngFor="let state of states" [value]="state">{{ state }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="app-filter-owner">
      <mat-select placeholder="Vlastník" [(value)]="filters.owner" (selectionChange)="onSelectedOwnerChanged($event)">
        <mat-option value="">Vše</mat-option>
        <mat-option *ngFor="let owner of owners" [value]="owner">{{ owner }}</mat-option>
      </mat-select>
    </mat-form-field>


    <mat-form-field class="app-filter-date-from">
      <input matInput [matDatepicker]="myDatepickerFrom" (dateInput)="onDateFromChanged()" placeholder="Od" [(ngModel)]='dateFrom' disabled>
      <mat-datepicker-toggle matSuffix [for]="myDatepickerFrom"></mat-datepicker-toggle>
      <mat-datepicker disabled="false" #myDatepickerFrom></mat-datepicker>
    </mat-form-field>
    <button *ngIf="!!dateFrom" class="app-filter-clear" mat-icon-button matTooltip="Zrušit datum od" (click)="clearDateFrom()">
      <mat-icon>clear</mat-icon>
    </button>


    <mat-form-field class="app-filter-date-to">
      <input matInput [matDatepicker]="myDatepickerTo" (dateInput)="onDateToChanged()" placeholder="Do" [(ngModel)]='dateTo' disabled>
      <mat-datepicker-toggle matSuffix [for]="myDatepickerTo"></mat-datepicker-toggle>
      <mat-datepicker disabled="false" #myDatepickerTo></mat-datepicker>
    </mat-form-field>

    <button *ngIf="!!dateTo" class="app-filter-clear" mat-icon-button matTooltip="Zrušit datum do" (click)="clearDateTo()">
      <mat-icon>clear</mat-icon>
    </button>

    <button class="app-filter-reload" mat-icon-button matTooltip="Obnovit" (click)="reload()">
      <mat-icon>refresh</mat-icon>
    </button>

  </div>

  <div class="app-processes-table">
    <div class="app-table">
      <div class="app-row app-header">
        <div class="process-expand"></div>
        <div class="process-id">ID</div>
        <div class="process-name">Název</div>
        <div class="process-state">Stav</div>
        <div class="process-datetime">Naplánováno</div>
        <div class="process-datetime">Spuštěno</div>
        <div class="process-datetime">Ukončeno</div>
        <div class="process-duration">Trvání</div>
        <div class="process-owner">Vlastník</div>
      </div>
    </div>
    <div class="scrollable app-table">
      <ng-container *ngFor="let batch of batches">
        <div class="app-row">
          <div class="process-expand">
            <button (click)="batch.expanded = !batch.expanded" *ngIf="batch.processes.length > 1" mat-icon-button
              color="primary" matTooltip="Zobrazit podprocesy">
              <mat-icon>{{ batch.expanded ? 'remove' : 'add' }}</mat-icon>
            </button>
          </div>
          <div class="process-id">{{ batch.batch.id }}</div>
          <div class="process-name">{{ batch.processes[0].name }}</div>
          <div class="process-state">{{ batch.batch.state }}</div>
          <div class="process-datetime">{{ batch.batch.planned | appDatetime }}</div>
          <div class="process-datetime">{{ batch.batch.started | appDatetime }}</div>
          <div class="process-datetime">{{ batch.batch.finished | appDatetime }}</div>
          <div class="process-duration">
            {{ toDurationInMs(batch.batch.started, batch.batch.finished) | appDuration }}</div>
          <div class="process-owner">{{ batch.batch.owner_login }}</div>
        </div>
        <ng-container *ngIf="batch.expanded">
          <div *ngFor="let process of batch.processes" class="app-row app-subprocess">
            <div class="process-expand"><mat-icon>arrow_right</mat-icon></div>
            <div class="process-id">{{ process.id }}</div>
            <div class="process-name">{{ process.name }}</div>
            <div class="process-state">{{ process.state }}</div>
            <div class="process-datetime">{{ process.planned | appDatetime }}</div>
            <div class="process-datetime">{{ process.started | appDatetime }}</div>
            <div class="process-datetime">{{ process.finished | appDatetime }}</div>
            <div class="process-duration">
              {{ toDurationInMs(process.started, process.finished) | appDuration }}</div>
            <div class="process-owner">{{ process.owner_login }}</div>
          </div>
        </ng-container>
      </ng-container>
      </div>

      <div class="paginator-wrapper">
        <mat-paginator [length]="resultCount" hidePageSize="true" [pageIndex]="pageIndex" [pageSize]="pageSize"
          (page)="onPageChanged($event)" >
        </mat-paginator>
      </div>
    </div>

  </div>