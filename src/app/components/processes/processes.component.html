<div class="container">

    <!-- filtrování výsledků -->
    <app-process-filter (dataChanged)="onFilterUpdated($event)"></app-process-filter>

    <div class="mat-elevation-z8">

        <table mat-table [dataSource]="tableDataSource">

            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let process">
                    <!-- TODO: poradit si s podprocesy, vizualizovat, ze proces je agragator -->
                    {{process.batch_id}}
                    <ng-container *ngIf="!!process.children && isBatchOpen(process.batch_id)">
                        <br>
                        <button mat-icon-button color="primary"><b>-</b></button>
                    </ng-container>
                    <ng-container *ngIf="!!process.children && !isBatchOpen(process.batch_id)">
                        <br>
                        <button mat-icon-button color="primary"><b>+</b></button>
                    </ng-container>
                </td>
            </ng-container>

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Název</th>
                <td mat-cell *matCellDef="let process">
                    <ng-container *ngIf="process.children">{{process.children[0].name|shorten:25}}</ng-container>
                    <ng-container *ngIf="!process.children">{{process.name|shorten:25}}</ng-container>
                </td>
            </ng-container>

            <ng-container matColumnDef="state">
                <th mat-header-cell *matHeaderCellDef>Stav</th>
                <td mat-cell *matCellDef="let process">
                    <div class="box">
                        <!-- see https://material.io/resources/icons/?style=baseline -->
                        <mat-icon *ngIf="process.batch_state=='PLANNED'">queue</mat-icon>
                        <mat-icon *ngIf="process.batch_state=='RUNNING'">360</mat-icon>
                        <mat-icon *ngIf="process.batch_state=='FINISHED'">done</mat-icon>
                        <mat-icon *ngIf="process.batch_state=='FAILED'">error_outline</mat-icon>
                        <span>&nbsp;{{process.batch_state}}</span>
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="planned">
                <th mat-header-cell *matHeaderCellDef>Naplánováno</th>
                <td mat-cell *matCellDef="let process">{{process.batch_planned | date:'W. L. y, H:mm:ss'}}</td>
            </ng-container>

            <ng-container matColumnDef="started">
                <th mat-header-cell *matHeaderCellDef>Spuštěno</th>
                <td mat-cell *matCellDef="let process">{{process.batch_started | date:'W. L. y, H:mm:ss'}}</td>
            </ng-container>

            <ng-container matColumnDef="finished">
                <th mat-header-cell *matHeaderCellDef>Ukončeno</th>
                <td mat-cell *matCellDef="let process">{{process.batch_finished | date:'W. L. y, H:mm:ss'}}</td>
            </ng-container>

            <ng-container matColumnDef="duration">
                <th mat-header-cell *matHeaderCellDef>Trvání</th>
                <td mat-cell *matCellDef="let process">
                    {{toDurationInMs(process.batch_started, process.batch_finished) | duration}}</td>
            </ng-container>

            <ng-container matColumnDef="owner">
                <th mat-header-cell *matHeaderCellDef>Vlastník</th>
                <td mat-cell *matCellDef="let process">{{process.batch_owner_login}}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="tableDisplayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: tableDisplayedColumns;"></tr>
        </table>

        <mat-paginator class="mat-paginator-sticky" [length]="processTotalCount" [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions" (page)="onPageEvent($event)">
        </mat-paginator>

    </div>

</div>