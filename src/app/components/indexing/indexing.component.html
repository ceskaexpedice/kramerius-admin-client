<div class="app-container-fluid app-import app-h-100">
	<div fxLayout="column" fxFlexFill>
		<div class="app-mb-4">Aktuální verze Indexeru: <strong>{{currentIndexerVersion}}</strong></div>
		<div fxLayout="row" fxLayoutGap="16px" class="app-mb-4">
			<mat-card class="app-card app-view-border app-w-100">
				<mat-card-header>
					<mat-card-title>Objekt(y)</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					Indexace objektu, nebo stromu, jehož je objekt kořenem. Na základě PIDu, nebo seznamu PIDů vloženého do formuláře, nebo načteného ze souboru.
				</mat-card-content>
				<mat-card-actions>
					<button mat-flat-button color="primary" (click)="openIndexationByPidDialog()">
						<mat-icon>play_arrow</mat-icon>Indexovat
					</button>
				</mat-card-actions>
			</mat-card>
			<mat-card class="app-card app-view-border app-w-100">
				<mat-card-header>
					<mat-card-title>Model</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					Indexace objektů (a jejich stromů), které mají vybraný model.
				</mat-card-content>
				<mat-card-actions>
					<mat-form-field appearance="fill" class="app-select app-mr-2">
						<mat-select placeholder="Model" [(value)]="selectedModel" (selectionChange)="onSelectModel($event)" [disabled]="loading">
							<mat-option *ngFor="let model of models; let i = index" [value]="model">{{modelNames[i]}}</mat-option>
						</mat-select>
					</mat-form-field>
					<button mat-flat-button color="primary" (click)="openIndexationByModelDialog()" [disabled]="loading || !selectedModel">
						<mat-icon>play_arrow</mat-icon>Indexovat
					</button>
				</mat-card-actions>
			</mat-card>
		</div>
		<div fxLayout="row" fxLayoutAlign="start center" class="app-mb-4">
			<div fxFlex>
				<mat-button-toggle-group [(ngModel)]="stateFilter" [disabled]="loading">
					<mat-button-toggle value="all" (change)="onChangeStateFilter($event.value)" [class.mat-button-toggle-checked]="stateFilter == 'all'">vše</mat-button-toggle>
					<mat-button-toggle value="not_indexed" (change)="onChangeStateFilter($event.value)" matTooltip="Doposud nebylo indexováno" matTooltipPosition="above">neindexováno</mat-button-toggle>
					<mat-button-toggle value="in_progress" (change)="onChangeStateFilter($event.value)" matTooltip="Probíhá kompletní indexace, nebo kompletní indexace nebyla řádně dokončena" matTooltipPosition="above">probíhá/chyba</mat-button-toggle>
					<mat-button-toggle value="indexed_current" (change)="onChangeStateFilter($event.value)" matTooltip="Indexováno aktuální verzí Indexeru" matTooltipPosition="above">indexováno</mat-button-toggle>
					<mat-button-toggle value="indexed_old" (change)="onChangeStateFilter($event.value)" matTooltip="Indexováno některou starší verzí indexeru" matTooltipPosition="above">indexováno (zastaralé)</mat-button-toggle>
				</mat-button-toggle-group>
			</div>
			<div>
				<button mat-flat-button color="primary" (click)="openIndexationsByMultiplePidsDialog()" matTooltip="Indexovat všechny aktuálně zobrazené objekty - každý ve vlastním procesu" [disabled]="loading || !selectedModel || noCurrentItems()">
					<mat-icon>play_arrow</mat-icon>Indexovat hromadně
				</button>
			</div>
		</div>
		<div class="app-table-wrapper app-view-border app-view-indexing app-oh app-mb-4">
			<div class="app-table app-head">
				<div class="app-row">
					<div class="app-col-pid">PID</div>
					<div class="app-col-name">Název</div>
					<div class="app-col-indexer-version-cont" matTooltip="Verze indexeru, kterou byl dokument indexován" matTooltipPosition="above">Verze</div>
					<div class="app-col-actions"></div>
				</div>
			</div>
			<div class="app-table app-body app-scrollable">
				<ng-container *ngFor="let object of getCurrentItems()">
					<a class="app-row" [href]="buildUserClientUrl(object.pid)" target="_blank">
						<div class="app-col-pid">{{ object.pid }}</div>
						<div class="app-col-name app-text-cutter" [matTooltip]="object.title">{{ object.title }}</div>
						<div class="app-col-indexer-version-cont">
							{{ object.indexerVersion!=undefined ? object.indexerVersion : 'n/a' }}
							<!-- 	<div *ngIf="object.indexerVersion!=undefined" class="app-object-indexer-version">
								{{object.indexerVersion}}
							</div>
							<div *ngIf="object.indexerVersion==undefined" class="app-object-indexer-version">
								n/a
							</div> -->
						</div>
						<div class="app-col-actions">
							<button (click)="openIndexationByPidDialog(object); $event.preventDefault(); $event.stopPropagation()" mat-icon-button matTooltip="Indexovat" matTooltipPosition="below" color="primary">
								<mat-icon>play_arrow</mat-icon>
							</button>
						</div>
					</a>
				</ng-container>
			</div>
		</div>
		<div fxLayout="row">
			<div fxFlex>
				<div *ngIf="repoNextOffset">Zpracováno {{repoNextOffset}} objektů</div>
				<div *ngIf="scheduledIndexationsCounter">Naplánováno {{scheduledIndexationsCounter}} indexací</div>
			</div>
			<div>
				<button mat-flat-button (click)="loadNextBatchOfItems()" [disabled]="loading || !selectedModel || !stateFilter"	matTooltip="Pokračovat v procházení repozitáře a načítaní dalších objektů" class="app-mr-2">
					Načíst další
				</button>
				<button mat-flat-button color="primary" (click)="openIndexationsByMultiplePidsDialog()" [disabled]="loading || !selectedModel || !stateFilter || noCurrentItems()" matTooltip="Indexovat všechny aktuálně zobrazené objekty - každý ve vlastním procesu">
					<mat-icon>play_arrow</mat-icon>Indexovat hromadně
				</button>
			</div>
		</div>
	</div>
</div>