<div class="app-indexing app-h-100">
  <div fxLayout="column" fxFlexFill>
    <div class="app-topbar">
      <div class="app-breadcrumbs app-mb-4">
        <mat-icon class="material-icons-outlined app-mr-2">home</mat-icon>
        <a routerLink="/">home</a>
        <span class="app-separator">/</span>
        <span class="app-last">{{ 'navbar.indexation' | translate }}</span>
      </div>
      <div>
        <nav mat-tab-nav-bar>
          <a mat-tab-link (click)="changeView('object')" [active]="view == 'object'"><mat-icon class="material-icons-outlined">data_object</mat-icon>{{ 'tabnav.object' | translate }}</a>
          <a mat-tab-link (click)="changeView('model')"  [active]="view == 'model'"><mat-icon class="material-icons-outlined">category</mat-icon>{{ 'tabnav.model' | translate }}</a>
        </nav>
      </div>
    </div>
    <div fxFlex class="app-oa-y">
      <div class="app-container-fluid">
				<ng-container *ngIf="view == 'object'">
					<mat-card class="app-card app-view-border" fxLayout="row">
						<div fxFlex>
							<mat-card-header>
								<mat-card-title>Objekt(y)</mat-card-title>
							</mat-card-header>
							<mat-card-content>
								Indexace objektu, nebo stromu, jehož je objekt kořenem. Na základě PIDu, nebo seznamu PIDů vloženého do formuláře, nebo načteného ze souboru.
							</mat-card-content>
							<mat-card-actions>
								<button mat-flat-button color="primary" (click)="openIndexationByPidDialog()">
									<mat-icon>play_arrow</mat-icon>Indexovat
								</button>
							</mat-card-actions>
						</div>
						<div>
							<span class="app-badge app-version app-mr-2">Aktuální verze Indexeru:&#160;<strong>{{ currentIndexerVersion }}</strong></span>
						</div>
					</mat-card>
				</ng-container>
				<ng-container *ngIf="view == 'model'">
					<mat-card class="app-card app-view-border app-mb-4" fxLayout="row">
						<div fxFlex>
							<mat-card-header>
								<mat-card-title>Model</mat-card-title>
							</mat-card-header>
							<mat-card-content>
								Indexace objektů (a jejich stromů), které mají vybraný model.
							</mat-card-content>
							<mat-card-actions>
								<mat-form-field class="app-mr-2 app-mb-n4">
									<mat-select placeholder="Vybrat model" [(value)]="selectedModel" (selectionChange)="onSelectModel($event)" [disabled]="loading">
										<mat-option *ngFor="let model of models; let i = index" [value]="model">{{modelNames[i]}}</mat-option>
									</mat-select>
								</mat-form-field>
								<button mat-flat-button color="primary" (click)="openIndexationByModelDialog()" [disabled]="loading || !selectedModel">
									<mat-icon>play_arrow</mat-icon>Indexovat
								</button>
							</mat-card-actions>
						</div>
						<div>
							<span class="app-badge app-version app-mr-2">Aktuální verze Indexeru:&#160;<strong>{{ currentIndexerVersion }}</strong></span>
						</div>
					</mat-card>

					<div fxLayout="row" fxLayoutAlign="start center" class="app-mb-4">
						<div fxFlex>
							<mat-button-toggle-group [(ngModel)]="stateFilter" [disabled]="loading">
								<mat-button-toggle value="all" (change)="onChangeStateFilter($event.value)" [class.mat-button-toggle-checked]="stateFilter == 'all'">vše</mat-button-toggle>
								<mat-button-toggle value="not_indexed" (change)="onChangeStateFilter($event.value)" matTooltip="Doposud nebylo indexováno" matTooltipPosition="above">neindexováno</mat-button-toggle>
								<mat-button-toggle value="in_progress" (change)="onChangeStateFilter($event.value)" matTooltip="Probíhá kompletní indexace, nebo kompletní indexace nebyla řádně dokončena" matTooltipPosition="above">probíhá/chyba</mat-button-toggle>
								<mat-button-toggle value="indexed_current" (change)="onChangeStateFilter($event.value)" matTooltip="Indexováno aktuální verzí Indexeru" matTooltipPosition="above">indexováno</mat-button-toggle>
								<mat-button-toggle value="indexed_old" (change)="onChangeStateFilter($event.value)" matTooltip="Indexováno některou starší verzí indexeru" matTooltipPosition="above">indexováno (zastaralé)</mat-button-toggle>
							</mat-button-toggle-group>
						</div>
						<div>
							<button mat-flat-button color="primary" (click)="openIndexationsByMultiplePidsDialog()" matTooltip="Indexovat všechny aktuálně zobrazené objekty - každý ve vlastním procesu" [disabled]="loading || !selectedModel || noCurrentItems()">
								<mat-icon>play_arrow</mat-icon>Indexovat hromadně
							</button>
						</div>
					</div>

					<div class="app-oa-y app-oh app-mb-4">
						<mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>
						<table mat-table [dataSource]="dataSource" class="app-view-border app-w-100" matSort>
							<ng-container matColumnDef="pid">
								<th mat-header-cell *matHeaderCellDef mat-sort-header>PID</th>
								<td mat-cell *matCellDef="let element">{{ element.pid }}</td>
							</ng-container>
							<ng-container matColumnDef="title">
								<th mat-header-cell *matHeaderCellDef mat-sort-header>Název</th>
								<td mat-cell *matCellDef="let element" [matTooltip]="element.title">
									<div class="app-text-cutter-wrapper">
										<div class="app-text-cutter">
											{{ element.title }}
										</div>
									</div>
								</td>
							</ng-container>
							<ng-container matColumnDef="indexerVersion">
								<th mat-header-cell *matHeaderCellDef matTooltip="Verze indexeru, kterou byl dokument indexován" >Verze</th>
								<td mat-cell *matCellDef="let element">	{{ element.indexerVersion != undefined ? element.indexerVersion : 'n/a' }}</td>
							</ng-container>
							<ng-container matColumnDef="action">
								<th mat-header-cell *matHeaderCellDef ></th>
								<td mat-cell *matCellDef="let element">
									<button (click)="openIndexationByPidDialog(element); $event.preventDefault(); $event.stopPropagation()" mat-icon-button matTooltip="Indexovat" matTooltipPosition="below" color="primary">
										<mat-icon>play_arrow</mat-icon>
									</button>
								</td>
							</ng-container>
							<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
							<tr mat-row *matRowDef="let row; columns: displayedColumns;" [routerLink]="[buildUserClientUrl(row.pid)]"></tr>
						</table>
					</div>

					<div fxLayout="row">
						<div fxFlex>
							<div *ngIf="repoNextOffset">Zpracováno {{repoNextOffset}} objektů</div>
							<div *ngIf="scheduledIndexationsCounter">Naplánováno {{scheduledIndexationsCounter}} indexací</div>
						</div>
						<div>
							<button mat-flat-button (click)="loadNextBatchOfItems()" [disabled]="loading || !selectedModel || !stateFilter"	matTooltip="Pokračovat v procházení repozitáře a načítaní dalších objektů" class="app-mr-2">
								Načíst další
							</button>
							<button mat-flat-button color="primary" (click)="openIndexationsByMultiplePidsDialog()" [disabled]="loading || !selectedModel || !stateFilter || noCurrentItems()" matTooltip="Indexovat všechny aktuálně zobrazené objekty - každý ve vlastním procesu">
								<mat-icon>play_arrow</mat-icon>Indexovat hromadně
							</button>
						</div>
					</div>
				</ng-container>
			</div>
		</div>
	</div>
</div>






<!-- <div class="app-container-fluid app-import app-h-100">
	<div fxLayout="column" fxFlexFill>
		<div class="app-mb-4">Aktuální verze Indexeru: <strong>{{currentIndexerVersion}}</strong></div>
		<div fxLayout="row" fxLayoutGap="16px" class="app-mb-4">
			<mat-card class="app-card app-view-border app-w-100">
				<mat-card-header>
					<mat-card-title>Objekt(y)</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					Indexace objektu, nebo stromu, jehož je objekt kořenem. Na základě PIDu, nebo seznamu PIDů vloženého do formuláře, nebo načteného ze souboru.
				</mat-card-content>
				<mat-card-actions>
					<button mat-flat-button color="primary" (click)="openIndexationByPidDialog()">
						<mat-icon>play_arrow</mat-icon>Indexovat
					</button>
				</mat-card-actions>
			</mat-card>
			<mat-card class="app-card app-view-border app-w-100">
				<mat-card-header>
					<mat-card-title>Model</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					Indexace objektů (a jejich stromů), které mají vybraný model.
				</mat-card-content>
				<mat-card-actions>
					<mat-form-field class="app-mr-2 app-mb-n4">
						<mat-select placeholder="Model" [(value)]="selectedModel" (selectionChange)="onSelectModel($event)" [disabled]="loading">
							<mat-option *ngFor="let model of models; let i = index" [value]="model">{{modelNames[i]}}</mat-option>
						</mat-select>
					</mat-form-field>
					<button mat-flat-button color="primary" (click)="openIndexationByModelDialog()" [disabled]="loading || !selectedModel">
						<mat-icon>play_arrow</mat-icon>Indexovat
					</button>
				</mat-card-actions>
			</mat-card>
		</div>
		<div fxLayout="row" fxLayoutAlign="start center" class="app-mb-4">
			<div fxFlex>
				<mat-button-toggle-group [(ngModel)]="stateFilter" [disabled]="loading">
					<mat-button-toggle value="all" (change)="onChangeStateFilter($event.value)" [class.mat-button-toggle-checked]="stateFilter == 'all'">vše</mat-button-toggle>
					<mat-button-toggle value="not_indexed" (change)="onChangeStateFilter($event.value)" matTooltip="Doposud nebylo indexováno" matTooltipPosition="above">neindexováno</mat-button-toggle>
					<mat-button-toggle value="in_progress" (change)="onChangeStateFilter($event.value)" matTooltip="Probíhá kompletní indexace, nebo kompletní indexace nebyla řádně dokončena" matTooltipPosition="above">probíhá/chyba</mat-button-toggle>
					<mat-button-toggle value="indexed_current" (change)="onChangeStateFilter($event.value)" matTooltip="Indexováno aktuální verzí Indexeru" matTooltipPosition="above">indexováno</mat-button-toggle>
					<mat-button-toggle value="indexed_old" (change)="onChangeStateFilter($event.value)" matTooltip="Indexováno některou starší verzí indexeru" matTooltipPosition="above">indexováno (zastaralé)</mat-button-toggle>
				</mat-button-toggle-group>
			</div>
			<div>
				<button mat-flat-button color="primary" (click)="openIndexationsByMultiplePidsDialog()" matTooltip="Indexovat všechny aktuálně zobrazené objekty - každý ve vlastním procesu" [disabled]="loading || !selectedModel || noCurrentItems()">
					<mat-icon>play_arrow</mat-icon>Indexovat hromadně
				</button>
			</div>
		</div>
		
		<div class="app-oa-y app-oh app-mb-4">
			<mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>
      <table mat-table [dataSource]="dataSource" class="app-view-border app-w-100" matSort>
        <ng-container matColumnDef="pid">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>PID</th>
          <td mat-cell *matCellDef="let element">{{ element.pid }}</td>
        </ng-container>
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Název</th>
          <td mat-cell *matCellDef="let element" [matTooltip]="element.title">
            <div class="app-text-cutter-wrapper">
              <div class="app-text-cutter">
                {{ element.title }}
              </div>
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="indexerVersion">
          <th mat-header-cell *matHeaderCellDef matTooltip="Verze indexeru, kterou byl dokument indexován" >Verze</th>
          <td mat-cell *matCellDef="let element">	{{ element.indexerVersion != undefined ? element.indexerVersion : 'n/a' }}</td>
        </ng-container>
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef ></th>
          <td mat-cell *matCellDef="let element">
						<button (click)="openIndexationByPidDialog(element); $event.preventDefault(); $event.stopPropagation()" mat-icon-button matTooltip="Indexovat" matTooltipPosition="below" color="primary">
							<mat-icon>play_arrow</mat-icon>
						</button>
					</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [routerLink]="[buildUserClientUrl(row.pid)]"></tr>
      </table>
    </div>
		<div fxLayout="row">
			<div fxFlex>
				<div *ngIf="repoNextOffset">Zpracováno {{repoNextOffset}} objektů</div>
				<div *ngIf="scheduledIndexationsCounter">Naplánováno {{scheduledIndexationsCounter}} indexací</div>
			</div>
			<div>
				<button mat-flat-button (click)="loadNextBatchOfItems()" [disabled]="loading || !selectedModel || !stateFilter"	matTooltip="Pokračovat v procházení repozitáře a načítaní dalších objektů" class="app-mr-2">
					Načíst další
				</button>
				<button mat-flat-button color="primary" (click)="openIndexationsByMultiplePidsDialog()" [disabled]="loading || !selectedModel || !stateFilter || noCurrentItems()" matTooltip="Indexovat všechny aktuálně zobrazené objekty - každý ve vlastním procesu">
					<mat-icon>play_arrow</mat-icon>Indexovat hromadně
				</button>
			</div>
		</div>
	</div>
</div> -->